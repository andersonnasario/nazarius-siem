# SIEM Platform - Production Environment Variables
# Copy this file to .env and fill with your production values
# DO NOT commit .env to git!

# ============================================================================
# DATABASE CREDENTIALS
# ============================================================================
# Generate strong passwords: openssl rand -base64 32
POSTGRES_PASSWORD=change_me_to_strong_password_min_32_chars
REDIS_PASSWORD=change_me_to_strong_password_min_32_chars

# ============================================================================
# REDIS CONFIGURATION
# ============================================================================
REDIS_ADDRESS=redis:6379
REDIS_USE_TLS=false  # Set to 'true' for AWS ElastiCache in production

# ============================================================================
# JWT SECRET
# ============================================================================
# Generate: openssl rand -base64 48
JWT_SECRET=change_me_to_strong_jwt_secret_min_48_chars

# ============================================================================
# DATA MODE CONFIGURATION
# ============================================================================
# DISABLE_MOCK_DATA=true  → Only show real data (empty if no data source)
# DISABLE_MOCK_DATA=false → Show mock data when real data unavailable (default)
DISABLE_MOCK_DATA=true

# USE_REAL_AWS_DATA=true  → Connect to real AWS services
# USE_REAL_AWS_DATA=false → Use mock AWS data (default)
USE_REAL_AWS_DATA=true

# ============================================================================
# AWS INTEGRATION (Optional - only if NOT using IAM Roles)
# ============================================================================
# If running in AWS (EC2/ECS), leave these empty - IAM Roles will be used automatically
# If running locally or need cross-account access, configure via UI: MDR → AWS Connections
# 
# These are fallback only - NOT RECOMMENDED for production
# AWS_ACCESS_KEY_ID=
# AWS_SECRET_ACCESS_KEY=
AWS_REGION=us-east-1
# AWS_ACCOUNT_ID=

# ============================================================================
# S3 CLOUDTRAIL MODE (For Centralized Multi-Account Logs)
# ============================================================================
# Use this when CloudTrail logs from multiple accounts are centralized in a S3 bucket.
# The SIEM will read logs directly from S3 instead of CloudTrail API.
#
# Architecture:
#   Account A (CloudTrail) ─┐
#   Account B (CloudTrail) ─┼──► S3 Bucket (SecOps Account) ──► SIEM reads from S3
#   Account C (CloudTrail) ─┘
#
# CLOUDTRAIL_S3_BUCKET: Name of the S3 bucket containing centralized logs
# CLOUDTRAIL_S3_PREFIX: Optional prefix path (e.g., "AWSLogs/" or "CloudTrail/")
# CLOUDTRAIL_SYNC_INTERVAL_MINUTES: How often to sync logs (default: 5)
#
# Example:
CLOUDTRAIL_S3_BUCKET=your-cloudtrail-bucket-name
CLOUDTRAIL_S3_PREFIX=AWSLogs/
CLOUDTRAIL_SYNC_INTERVAL_MINUTES=5

# ============================================================================
# SECURITY HUB MODE (For Centralized CSPM)
# ============================================================================
# Use this when Security Hub Aggregator is configured to centralize findings
# from multiple AWS accounts and services (GuardDuty, Inspector, Config, etc.)
#
# Architecture:
#   Account A (GuardDuty, Config) ─┐
#   Account B (Inspector, Macie)  ─┼──► Security Hub Aggregator (SecOps) ──► SIEM
#   Account C (All services)      ─┘
#
# USE_SECURITY_HUB: Enable Security Hub mode for centralized CSPM
# SECURITYHUB_SYNC_INTERVAL_MINUTES: How often to sync findings (default: 5)
#
USE_SECURITY_HUB=true
SECURITYHUB_SYNC_INTERVAL_MINUTES=5

# ============================================================================
# CORS ORIGINS (Optional)
# ============================================================================
# Comma-separated list of allowed origins
# CORS_ORIGINS=https://siem.yourdomain.com,https://app.yourdomain.com

# ============================================================================
# ELASTICSEARCH / OPENSEARCH (Optional)
# ============================================================================
# If using external Elasticsearch
# ELASTICSEARCH_URL=https://your-elasticsearch-cluster:9200
# ELASTICSEARCH_USERNAME=
# ELASTICSEARCH_PASSWORD=

# AWS OpenSearch Configuration (Production)
ELASTICSEARCH_HOST=https://your-opensearch-domain.region.es.amazonaws.com
ELASTICSEARCH_USERNAME=admin
ELASTICSEARCH_PASSWORD=change_me_to_strong_password
ELASTICSEARCH_USE_TLS=true  # Set to 'true' for AWS OpenSearch

# ============================================================================
# CLOUDFLARE WAF INTEGRATION
# ============================================================================
# ⭐ MÉTODO RECOMENDADO: Configurar via Interface Web
#    Menu: Integrações → CloudFlare → Configurar
#    Vantagens:
#      - Token criptografado no OpenSearch (mais seguro)
#      - Sem necessidade de restart
#      - Validação integrada (botão "Testar Conexão")
#      - Auditável
#
# Deixar vazio - será configurado pela UI e salvo no OpenSearch
CLOUDFLARE_API_TOKEN=
CLOUDFLARE_ACCOUNT_ID=
CLOUDFLARE_ZONE_IDS=
CLOUDFLARE_ENABLED=false  # Ativado automaticamente pela interface
CLOUDFLARE_SYNC_INTERVAL_MINUTES=5

# ⚠️ Fallback: Configuração via variável de ambiente (menos seguro)
# Use apenas se NÃO puder usar a interface web
# Token ficará em texto plano no arquivo .env
# Para usar: descomente e preencha as linhas abaixo
# CLOUDFLARE_API_TOKEN=seu_token_aqui
# CLOUDFLARE_ACCOUNT_ID=seu_account_id_aqui
# CLOUDFLARE_ENABLED=true
#
# Criar token em: https://dash.cloudflare.com/profile/api-tokens
# Permissões: Zone:Logs:Read, Zone:Analytics:Read, Zone:Firewall:Read
# Account ID: https://dash.cloudflare.com/ (barra lateral direita)

# ============================================================================
# AUTOMATED RESPONSE CONFIGURATION
# ============================================================================
# IMPORTANTE: Para ambiente PCI-DSS inicial, manter DESABILITADO
# Habilitar apenas após período de observação (30-60 dias) e testes extensivos
AUTOMATED_RESPONSE_ENABLED=false

# ============================================================================
# NVD (National Vulnerability Database) API
# ============================================================================
# API Key para sincronização de CVEs com o NVD/NIST
# Aumenta o rate limit de 5 requests/30s para 50 requests/30s
# Obter em: https://nvd.nist.gov/developers/request-an-api-key
NVD_API_KEY=

# ============================================================================
# VPC FLOW LOGS (Network Analysis)
# ============================================================================
# S3 bucket contendo VPC Flow Logs
VPC_FLOWLOGS_S3_BUCKET=
VPC_FLOWLOGS_S3_PREFIX=

# ============================================================================
# PRODUCTION CHECKLIST
# ============================================================================
# [ ] Set DISABLE_MOCK_DATA=true (show only real data)
# [ ] Set USE_REAL_AWS_DATA=true (connect to real AWS)
# [ ] Changed POSTGRES_PASSWORD to strong password
# [ ] Changed REDIS_PASSWORD to strong password
# [ ] Changed JWT_SECRET to strong secret
# [ ] Set REDIS_USE_TLS=true for AWS ElastiCache
# [ ] Set ELASTICSEARCH_USE_TLS=true for AWS OpenSearch
# [ ] Configured OpenSearch credentials (username/password)
# [ ] Configured CORS_ORIGINS for your domain
# [ ] If in AWS: Attached IAM Role to EC2/ECS
# [ ] If cross-account: Configured AWS Connections via UI
# [ ] If centralized logs: Set CLOUDTRAIL_S3_BUCKET and CLOUDTRAIL_S3_PREFIX
# [ ] Configured CloudFlare: Set CLOUDFLARE_API_TOKEN and CLOUDFLARE_ACCOUNT_ID
# [ ] Set AUTOMATED_RESPONSE_ENABLED=false (initial deployment)
# [ ] Reviewed security settings
# [ ] Configured SSL/TLS (if applicable)
# [ ] Set up monitoring and alerts
# [ ] Configured backups for PostgreSQL

# ============================================================================
# IAM PERMISSIONS REQUIRED
# ============================================================================
# The ECS Task Role needs these permissions:
#
# For S3 CloudTrail Mode (reading centralized logs):
#   - s3:GetObject (on the CloudTrail bucket)
#   - s3:ListBucket (on the CloudTrail bucket)
#
# For GuardDuty:
#   - guardduty:ListDetectors
#   - guardduty:ListFindings
#   - guardduty:GetFindings
#
# For Security Hub (centralized CSPM):
#   - securityhub:GetFindings
#   - securityhub:DescribeHub
#   - securityhub:ListFindingAggregators
#
# Example IAM Policy:
# {
#   "Version": "2012-10-17",
#   "Statement": [
#     {
#       "Sid": "S3CloudTrailAccess",
#       "Effect": "Allow",
#       "Action": ["s3:GetObject", "s3:ListBucket"],
#       "Resource": [
#         "arn:aws:s3:::your-cloudtrail-bucket",
#         "arn:aws:s3:::your-cloudtrail-bucket/*"
#       ]
#     },
#     {
#       "Sid": "GuardDutyRead",
#       "Effect": "Allow",
#       "Action": [
#         "guardduty:ListDetectors",
#         "guardduty:ListFindings",
#         "guardduty:GetFindings"
#       ],
#       "Resource": "*"
#     },
#     {
#       "Sid": "SecurityHubRead",
#       "Effect": "Allow",
#       "Action": [
#         "securityhub:GetFindings",
#         "securityhub:DescribeHub",
#         "securityhub:ListFindingAggregators"
#       ],
#       "Resource": "*"
#     }
#   ]
# }

